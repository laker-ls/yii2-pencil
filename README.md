<h1 align="center">
    yii2-pencil
</h1>


[![Stable Version](https://poser.pugx.org/laker-ls/yii2-pencil/v/stable)](https://packagist.org/packages/laker-ls/yii2-pencil)
[![Unstable Version](https://poser.pugx.org/laker-ls/yii2-pencil/v/unstable)](https://packagist.org/packages/laker-ls/yii2-pencil)
[![License](https://poser.pugx.org/laker-ls/yii2-pencil/license)](https://packagist.org/packages/laker-ls/yii2-pencil)
[![Total Downloads](https://poser.pugx.org/laker-ls/yii2-pencil/downloads)](https://packagist.org/packages/laker-ls/yii2-pencil)

> ВНИМАНИЕ: расширение работает только с существующей таблицей `category` в базе данных, где хранится `id` страницы.
Для работы так же необходим Rbac с существующей ролью. Используется bootstrap 4.

Отображение текста, которое редактируется через модальное окно, когда пользователь авторизован как администратор.
Не админ, видит обычный текст, в то же время администратор может взаимодействовать с ним, по нажатию на текст
всплывает модальное окно с одним полем textarea, переносы в данном поле работают и конвертируются в `<br />`, вся
стилизация текста должна задаваться через css. <br />
Вы можете настраивать в каком теге выводить текст и передавать ему классы и другие атрибуты.
Вид текста для администратора отличается и может быть дополнен атрибутами, которые выводят только для админа.

Отображение изображений, которые редактируются через модальное окна, когда пользователь авторизован как администратор.
Все пользователи видят изображения, однако админу дополнительно отображается кнопка для редактирования изображений.
  
## Установка

Рекомендуемый способ установки этого расширения является использование [composer](http://getcomposer.org/download/).
Проверьте [composer.json](https://github.com/laker-ls/yii2-pencil/blob/master/composer.json) на предмет требований и зависимостей данного расширения.

Для установки запустите

```
$ php composer.phar require laker-ls/yii2-pencil "~1.3.0"
```

или добавьте в `composer.json` в раздел `require` следующую строку

```
"laker-ls/yii2-pencil": "~1.3.0"
```

> Смотрите [список изменений](https://github.com/laker-ls/yii2-pencil/blob/master/CHANGE.md) для подробной информации о версиях.

## Подключение
Исполните миграции в консоли:
```
yii migrate --migrationPath=@lakerLS/pencil/migrations
```

В конфиге приложения подключите модуль и укажите роли (обязательно) параметром `accessRoles`, для которых разрешен доступ.
Параметром `imagePath` укажите существующую папку в директории `web` приложения для сохранения изображений:
```php
'modules' => [
    'pencil' => [
        'class' => '\lakerLS\pencil\Module',
        'params' => [
            'accessRoles' => ['admin'],
            'imagePath' => 'upload/image-gallery',
        ],
    ],
]
```

В контроллере, в котором вызывается экшен с "карандашами" обязательно должно передаваться `id` текущей
категории. Данный код служит примером, в каждом случае переданные параметры будут отличаться, но свойствой `categoryId` не должно
менять своё имя.
```php
    public $categoryId;
    
    public function actionIndex($category)
    {
        // Где $category объект текущей категории.
        $this->categoryId = $category->id;
        
        // Если страница статическая, то можем задать `id` явно, но данный способ не является хорошей практикой.
        $this->categoryId = 1;
        
        return $this->render('view');
    }
```

Расширение готово к работе.

## Использование виджета для текста

```php
use lakerLS\pencil\widgets\PencilText;
           
<?= PencilText::widget(['id' => 'example-id']) ?>
```

Использование виджета в layout:
```php
use lakerLS\pencil\widgets\PencilText;
           
<?= PencilText::widget(['id' => 'example-id', 'layout' => 'this-name-layout']) ?>
```

С использованием дополнительных параметров:
```php
use lakerLS\pencil\widgets\Pencil;
           
<?= PencilText::widget(['id' => 'example-id', 'tag' => 'h2', 'options' => ['class' => 'my-class']]) ?>
```

`id` (string) - обязательный параметр, для удобства, id указывать строкой. Необходимы уникальные имена в пределах одной страницы.
Повторное использование имен на других страницах не вызовет конфликта.

`tag` (string) - имя тега, в котором будет содержимое.

`options` (array) - параметры тега, которые видны как всем пользователям, так и администратору.

`layout` (string) - Для размещение текста в `layout` необходимо передать его имя.

`optionsAdmin` (array) - параметры тега, которые видет только администратор. С помощью классов и стилей задается такой стиль текста,
что бы было понятно, что он интерактивен (можно редактировать). По умолчанию синее подчеркивание.

`textIsEmpty` (string) - текст который виден админу если содержимое пусто или не существует,
для возможности редактирования, т.к. текст единственный способ вызвать модальное окно администратору.

## Использование виджета для изображений

Используйте `Image::widget()` для отображения кнопки редактирования. <br />
Используйте `Image::arrayImg()` для получения массива с изображениями для последующего отображения.

Для использования виджета в layout'е обязательно передать в параметр `layout` имя layout'a.

Стандартное использование, которое подходит для отображения коллекций изображений:

```php
use lakerLS\pencil\widgets\PencilImage;
 
 <?php
 foreach (PencilImage::arrayImg(['group' => 'Новости']) as $image) {
    echo Html::img($image->src, ['alt' => $image->alt]);
 }
 echo PencilImage::widget(['group' => 'Новости']);
 ?>
```
Альтернативное использование, которое подходит для отображения одного изображения, при этом не влияя на верстку
(не добавляет лишние отступы, отображается на изображении в нижнем правом углу).

В каждом конкретном случае используйте свои html теги, которые используются в шаблоне:
> ВАЖНО: используя значение `true` для параметра `small` обязательно указывайте родительскому элементу в котором 
расположено изображение позицию `relative`.

```html
<div class="example" style="position: relative">
<?php foreach (PencilImage::arrayImg(['group' => 'Новости']) as $image) : ?>
    <?= Html::img($image->src, ['alt' => $image->alt]) ?>
<?php endforeach; ?>
</div>
<?= PencilImage::widget(['group' => 'Новости', 'small' => true]) ?>
```

`group` (string) - обязательный параметр, который необходимо передавать для создания альбома изображений.
Может использоваться кириллица.

`small` (boolean) - Необязательный параметр. По умолчанию `false`.<br />
Если значение `false`, отображается большая кнопка для редактирования. 
Подходит для создания/редактирования альбомов. <br />
Если значение `true`, кнопка имеет маленький размер и позицию absolute.

`layout` (string) - Для размещение текста в `layout` необходимо передать его имя.

## Лицензия

**yii2-pencil** выпущено по лицензии BSD-3-Clause. Ознакомиться можно в файле `LICENSE.md`.
